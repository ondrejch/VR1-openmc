""" Tally definitions VR1 """

import openmc
from vr1.materials import VR1Materials

tally_types: list[str] = [
    'fuel flux',
    'water flux',
    'core flux',
    # 'radial channel flux',
    # 'tangential channel flux',
]
# TODO: more tallies


class VR1Tally:
    def __init__(self):
        self.flux_tally = openmc.Tally()

    def get(self):
        return self.flux_tally


class FluxTally(VR1Tally):
    """ Returns flux tally """
    def __init__(self, material: VR1Materials, tally_type: str) -> None:
        if tally_type not in tally_types:
            raise ValueError(f'Tally type {tally_type} is not valid')
        self.tally_type = tally_type
        self.material = material
        super().__init__()

        energy_bins = scale_252_energy_bins
        energy_filter = openmc.EnergyFilter(energy_bins)
        self.flux_tally.name = tally_type
        cell_filter = None
        if self.tally_type == 'fuel flux':
            cell_filter = openmc.MaterialFilter(material.fuel)
        elif self.tally_type == 'water flux':
            cell_filter = openmc.MaterialFilter(material.water)
        if cell_filter:
            self.flux_tally.filters = [cell_filter, energy_filter]
        else:
            self.flux_tally.filters = [energy_filter]


""" SCALE 252 group energy structure """
scale_252_energy_bins: list[float] = [
    2.0000000000E+07,
    1.7330000000E+07,
    1.5680000000E+07,
    1.4550000000E+07,
    1.3840000000E+07,
    1.2840000000E+07,
    1.0000000000E+07,
    8.1870000000E+06,
    6.4340000000E+06,
    4.8000000000E+06,
    4.3040000000E+06,
    3.0000000000E+06,
    2.4790000000E+06,
    2.3540000000E+06,
    1.8500000000E+06,
    1.5000000000E+06,
    1.4000000000E+06,
    1.3560000000E+06,
    1.3170000000E+06,
    1.2500000000E+06,
    1.2000000000E+06,
    1.1000000000E+06,
    1.0100000000E+06,
    9.2000000000E+05,
    9.0000000000E+05,
    8.7500000000E+05,
    8.6110000000E+05,
    8.2000000000E+05,
    7.5000000000E+05,
    6.7900000000E+05,
    6.7000000000E+05,
    6.0000000000E+05,
    5.7300000000E+05,
    5.5000000000E+05,
    4.9200000000E+05,
    4.7000000000E+05,
    4.4000000000E+05,
    4.2000000000E+05,
    4.0000000000E+05,
    3.3000000000E+05,
    2.7000000000E+05,
    2.0000000000E+05,
    1.4900000000E+05,
    1.2830000000E+05,
    1.0000000000E+05,
    8.5000000000E+04,
    8.2000000000E+04,
    7.5000000000E+04,
    7.3000000000E+04,
    6.0000000000E+04,
    5.2000000000E+04,
    5.0000000000E+04,
    4.5000000000E+04,
    3.0000000000E+04,
    2.0000000000E+04,
    1.7000000000E+04,
    1.3000000000E+04,
    9.5000000000E+03,
    8.0300000000E+03,
    5.7000000000E+03,
    3.9000000000E+03,
    3.7400000000E+03,
    3.0000000000E+03,
    2.5000000000E+03,
    2.2500000000E+03,
    2.2000000000E+03,
    1.8000000000E+03,
    1.5500000000E+03,
    1.5000000000E+03,
    1.1500000000E+03,
    9.5000000000E+02,
    6.8300000000E+02,
    6.7000000000E+02,
    5.5000000000E+02,
    3.0500000000E+02,
    2.8500000000E+02,
    2.4000000000E+02,
    2.2000000000E+02,
    2.0950000000E+02,
    2.0740000000E+02,
    2.0200000000E+02,
    1.9300000000E+02,
    1.9150000000E+02,
    1.8850000000E+02,
    1.8770000000E+02,
    1.8000000000E+02,
    1.7000000000E+02,
    1.4300000000E+02,
    1.2200000000E+02,
    1.1900000000E+02,
    1.1750000000E+02,
    1.1600000000E+02,
    1.1300000000E+02,
    1.0800000000E+02,
    1.0500000000E+02,
    1.0120000000E+02,
    9.7000000000E+01,
    9.0000000000E+01,
    8.1700000000E+01,
    8.0000000000E+01,
    7.6000000000E+01,
    7.2000000000E+01,
    6.7500000000E+01,
    6.5000000000E+01,
    6.3000000000E+01,
    6.1000000000E+01,
    5.8000000000E+01,
    5.3400000000E+01,
    5.0600000000E+01,
    4.8300000000E+01,
    4.5200000000E+01,
    4.4000000000E+01,
    4.2400000000E+01,
    4.1000000000E+01,
    3.9600000000E+01,
    3.9100000000E+01,
    3.8000000000E+01,
    3.7630000000E+01,
    3.7270000000E+01,
    3.7130000000E+01,
    3.7000000000E+01,
    3.6000000000E+01,
    3.5500000000E+01,
    3.5000000000E+01,
    3.3750000000E+01,
    3.3250000000E+01,
    3.1750000000E+01,
    3.1250000000E+01,
    3.0000000000E+01,
    2.7500000000E+01,
    2.5000000000E+01,
    2.2500000000E+01,
    2.1750000000E+01,
    2.1200000000E+01,
    2.0500000000E+01,
    2.0000000000E+01,
    1.9400000000E+01,
    1.8500000000E+01,
    1.7000000000E+01,
    1.6000000000E+01,
    1.4400000000E+01,
    1.2900000000E+01,
    1.1900000000E+01,
    1.1500000000E+01,
    1.0000000000E+01,
    9.1000000000E+00,
    8.1000000000E+00,
    7.1500000000E+00,
    7.0000000000E+00,
    6.8750000000E+00,
    6.7500000000E+00,
    6.5000000000E+00,
    6.2500000000E+00,
    6.0000000000E+00,
    5.4000000000E+00,
    5.0000000000E+00,
    4.7000000000E+00,
    4.1000000000E+00,
    3.7300000000E+00,
    3.5000000000E+00,
    3.2000000000E+00,
    3.1000000000E+00,
    3.0000000000E+00,
    2.9700000000E+00,
    2.8700000000E+00,
    2.7700000000E+00,
    2.6700000000E+00,
    2.5700000000E+00,
    2.4700000000E+00,
    2.3800000000E+00,
    2.3000000000E+00,
    2.2100000000E+00,
    2.1200000000E+00,
    2.0000000000E+00,
    1.9400000000E+00,
    1.8600000000E+00,
    1.7700000000E+00,
    1.6800000000E+00,
    1.5900000000E+00,
    1.5000000000E+00,
    1.4500000000E+00,
    1.4000000000E+00,
    1.3500000000E+00,
    1.3000000000E+00,
    1.2500000000E+00,
    1.2250000000E+00,
    1.2000000000E+00,
    1.1750000000E+00,
    1.1500000000E+00,
    1.1400000000E+00,
    1.1300000000E+00,
    1.1200000000E+00,
    1.1100000000E+00,
    1.1000000000E+00,
    1.0900000000E+00,
    1.0800000000E+00,
    1.0700000000E+00,
    1.0600000000E+00,
    1.0500000000E+00,
    1.0400000000E+00,
    1.0300000000E+00,
    1.0200000000E+00,
    1.0100000000E+00,
    1.0000000000E+00,
    9.7500000000E-01,
    9.5000000000E-01,
    9.2500000000E-01,
    9.0000000000E-01,
    8.5000000000E-01,
    8.0000000000E-01,
    7.5000000000E-01,
    7.0000000000E-01,
    6.5000000000E-01,
    6.2500000000E-01,
    6.0000000000E-01,
    5.5000000000E-01,
    5.0000000000E-01,
    4.5000000000E-01,
    4.0000000000E-01,
    3.7500000000E-01,
    3.5000000000E-01,
    3.2500000000E-01,
    3.0000000000E-01,
    2.7500000000E-01,
    2.5000000000E-01,
    2.2500000000E-01,
    2.0000000000E-01,
    1.7500000000E-01,
    1.5000000000E-01,
    1.2500000000E-01,
    1.0000000000E-01,
    9.0000000000E-02,
    8.0000000000E-02,
    7.0000000000E-02,
    6.0000000000E-02,
    5.0000000000E-02,
    4.0000000000E-02,
    3.0000000000E-02,
    2.5300000000E-02,
    1.0000000000E-02,
    7.5000000000E-03,
    5.0000000000E-03,
    4.0000000000E-03,
    3.0000000000E-03,
    2.5000000000E-03,
    2.0000000000E-03,
    1.5000000000E-03,
    1.2000000000E-03,
    1.0000000000E-03,
    7.5000000000E-04,
    5.0000000000E-04,
    1.0000000000E-04,
    1.0e-5 ]
